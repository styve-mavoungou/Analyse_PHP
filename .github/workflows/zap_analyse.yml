name: üîç Analyse DAST avec OWASP ZAP

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  zap_scan:
    name: Ex√©cuter OWASP ZAP
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ R√©cup√©ration du code source
      - name: üì¶ R√©cup√©ration du d√©p√¥t
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Installation de Docker (ZAP s'ex√©cute dans un conteneur)
      - name: üê≥ V√©rification de Docker
        run: docker --version

      # 3Ô∏è‚É£ Lancement de l‚Äôanalyse OWASP ZAP
      - name: ‚ö° Lancer l‚Äôanalyse OWASP ZAP
        run: |
          echo "D√©marrage de l‚Äôanalyse OWASP ZAP..."
          docker run -v $(pwd):/zap/wrk/:rw \
            ghcr.io/zaproxy/zaproxy:stable zap-baseline.py \
            -t http://127.0.0.1:8000 \
            -r zap_report.html \
            -w zap_report.txt \
            -x zap_report.xml \
            -I

      # 4Ô∏è‚É£ Enregistrement du rapport texte
      - name: üìÑ Upload rapport TXT
        uses: actions/upload-artifact@v4
        with:
          name: zap-rapport-txt
          path: zap_report.txt

      # 5Ô∏è‚É£ Enregistrement du rapport HTML (plus visuel)
      - name: üåê Upload rapport HTML
        uses: actions/upload-artifact@v4
        with:
          name: zap-rapport-html
          path: zap_report.html

      # 6Ô∏è‚É£ Enregistrement du rapport XML (optionnel)
      - name: üß© Upload rapport XML
        uses: actions/upload-artifact@v4
        with:
          name: zap-rapport-xml
          path: zap_report.xml
