name: ğŸ” Analyse DAST avec OWASP ZAP

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  zap_scan:
    name: ExÃ©cuter OWASP ZAP
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ RÃ©cupÃ©rer le code source
      - name: ğŸ“¦ Checkout dÃ©pÃ´t
        uses: actions/checkout@v4

      # 2ï¸âƒ£ VÃ©rifier Docker
      - name: ğŸ³ VÃ©rification de Docker
        run: docker --version

      # 3ï¸âƒ£ Lancer lâ€™analyse ZAP
      - name: âš¡ Lancer lâ€™analyse OWASP ZAP
        run: |
          echo "DÃ©marrage de lâ€™analyse OWASP ZAP..."
          docker run -v ${{ github.workspace }}:/zap/wrk/:rw \
            ghcr.io/zaproxy/zaproxy:stable zap-baseline.py \
            -t https://dedicated-emerita-unallied.ngrok-free.dev \
            -w /zap/wrk/zap_report.txt

      # 4ï¸âƒ£ VÃ©rifier que le fichier TXT existe
      - name: ğŸ” VÃ©rifier le rapport TXT
        run: ls -l zap_report.txt

      # 5ï¸âƒ£ Upload du rapport TXT
      - name: ğŸ“„ Upload rapport TXT
        uses: actions/upload-artifact@v4
        with:
          name: zap-rapport-txt
          path: zap_report.txt
