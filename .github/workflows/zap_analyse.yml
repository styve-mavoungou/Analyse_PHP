name: ğŸ” Analyse DAST avec OWASP ZAP

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  zap_scan:
    name: ExÃ©cuter OWASP ZAP
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ RÃ©cupÃ©ration du dÃ©pÃ´t
        uses: actions/checkout@v4

      - name: ğŸ³ VÃ©rification de Docker
        run: docker --version

      - name: âš¡ Lancer lâ€™analyse OWASP ZAP
        run: |
          echo "DÃ©marrage de lâ€™analyse OWASP ZAP..."
          docker run -v ${{ github.workspace }}:/zap/wrk/:rw \
            ghcr.io/zaproxy/zaproxy:stable zap-baseline.py \
            -t https://dedicated-emerita-unallied.ngrok-free.dev \
            -r /zap/wrk/zap_report.html \
            -w /zap/wrk/zap_report.txt \
            -x /zap/wrk/zap_report.xml \
            -I

      - name: ğŸ” VÃ©rifier les fichiers ZAP
        run: ls -l zap_report.*

      - name: ğŸ“„ Upload rapport TXT
        uses: actions/upload-artifact@v4
        with:
          name: zap-rapport-txt
          path: zap_report.txt

      - name: ğŸŒ Upload rapport HTML
        uses: actions/upload-artifact@v4
        with:
          name: zap-rapport-html
          path: zap_report.html

      - name: ğŸ§© Upload rapport XML
        uses: actions/upload-artifact@v4
        with:
          name: zap-rapport-xml
          path: zap_report.xml
