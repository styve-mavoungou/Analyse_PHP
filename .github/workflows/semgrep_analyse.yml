name: ðŸ” Analyse SAST avec Semgrep

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  semgrep_scan:
    name: ExÃ©cuter Semgrep
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¦ Cloner le dÃ©pÃ´t
        uses: actions/checkout@v4
      
      - name: ðŸ§° Installer Semgrep
        run: pip install semgrep
      
      - name: ðŸ” VÃ©rifier les fichiers prÃ©sents
        run: |
          echo "=== Fichiers dans le rÃ©pertoire ==="
          ls -la
          echo ""
          echo "=== VÃ©rification du fichier de rÃ¨gles ==="
          if [ -f "regles_vulnerabilites.yml" ]; then
            echo "âœ… Fichier regles_vulnerabilites.yml trouvÃ©"
          else
            echo "âŒ Fichier regles_vulnerabilites.yml NON TROUVÃ‰"
            exit 1
          fi
      
      - name: ðŸš€ Analyse Semgrep
        run: |
          echo "=== DÃ‰BUT DE L'ANALYSE SEMGREP ==="
          semgrep scan --config regles_vulnerabilites.yml --text --no-git-ignore . > rapport_semgrep.txt 2>&1 || true
          echo "=== FIN DE L'ANALYSE ==="
      
      - name: ðŸ“„ Afficher le rapport complet
        if: always()
        run: |
          echo "==================================================="
          echo "           RAPPORT D'ANALYSE SEMGREP"
          echo "==================================================="
          cat rapport_semgrep.txt
          echo "==================================================="
      
      - name: ðŸ“¤ Sauvegarder le rapport
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: rapport-semgrep
          path: rapport_semgrep.txt
          retention-days: 30
