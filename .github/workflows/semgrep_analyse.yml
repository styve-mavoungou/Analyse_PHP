name: ğŸ” Analyse SAST avec Semgrep

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  semgrep_scan:
    name: ExÃ©cuter Semgrep (analyse statique)
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ RÃ©cupÃ©ration du code source
      - name: ğŸ“¦ Cloner le dÃ©pÃ´t
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Installation de Semgrep
      - name: ğŸ§° Installer Semgrep
        run: |
          pip install semgrep

      # 3ï¸âƒ£ ExÃ©cution de lâ€™analyse
      - name: ğŸš€ Lancer lâ€™analyse Semgrep
        run: |
          semgrep scan --config=auto --error --timeout 300 . > rapport_semgrep.txt

      # 4ï¸âƒ£ Afficher le rÃ©sultat dans la console
      - name: ğŸ“„ Afficher le rapport dans le terminal
        run: cat rapport_semgrep.txt

      # 5ï¸âƒ£ Sauvegarde du rapport comme artefact (version 4)
      - name: ğŸ“¤ Sauvegarder le rapport dâ€™analyse
        uses: actions/upload-artifact@v4
        with:
          name: rapport_semgrep
          path: rapport_semgrep.txt
          retention-days: 7  # durÃ©e de conservation facultative (par dÃ©faut : 90 jours)
