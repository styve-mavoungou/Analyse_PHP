name: ğŸ” Analyse SAST avec Semgrep

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  semgrep_scan:
    name: ExÃ©cuter Semgrep (analyse statique)
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ Cloner le dÃ©pÃ´t
      - name: ğŸ“¦ Cloner le dÃ©pÃ´t
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Installer Semgrep
      - name: ğŸ§° Installer Semgrep
        run: pip install semgrep

      # 3ï¸âƒ£ ExÃ©cuter lâ€™analyse avec ton fichier de rÃ¨gles
      - name: ğŸš€ Lancer lâ€™analyse Semgrep personnalisÃ©e
        run: |
          semgrep scan --config regles_vulnerabilites.yml --error --timeout 300 . > rapport_semgrep.txt

      # 4ï¸âƒ£ Afficher le rapport dans la console
      - name: ğŸ“„ Afficher le rapport
        run: cat rapport_semgrep.txt

      # 5ï¸âƒ£ Sauvegarder le rapport
      - name: ğŸ“¤ Sauvegarder le rapport dâ€™analyse
        uses: actions/upload-artifact@v4
        with:
          name: rapport_semgrep
          path: rapport_semgrep.txt
          retention-days: 7
